<!DOCTYPE html>
<meta charset="utf-8">
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Open+Sans|Ruda' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Ruda:400,900,700' rel='stylesheet' type='text/css'>
    <link type="text/css" rel="stylesheet" href="../../../css/reset.css">
    <link type="text/css" rel="stylesheet" href="../../../css/global-styles.css">

<link rel="stylesheet" type="text/css" href="css/budget.css">
<style>
h3 {
  margin-top: 30px;
  margin-bottom: 30px;
  display:inline-block;
  padding-right: 5px;
}


</style>

<!--
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip 


.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\ 25BC";
  position: absolute;
  text-align: center;
}

-->



<body>


  <h1>The cost and effectiveness of food aid</h1>

  
  <!-- <p class="dropcap">The U.S. government runs the worldâ€™s largest and longest-running food aid program. On an average year, U.S. taxpayers help feed over 30 million hungry and starving people. However, there are long-standing questions about the efficiency and effectiveness of this system, put in place originally by President Eisenhower in 1954.</p> -->

  <p>Unlike other countries' food aid programs, which send cash to buy food locally, the taxpayer-funded USAID Food for Peace program ships commodities grown stateside to famine-affected parts of the world. According to USAID, only 40 percent of the program's bduget is spent on food itself. The rest goes to U.S.-based processors, which are owned by agribusinesses, and shippers based at U.S. ports. Over the last 10 years the cost of food has risen even as fewer people benefit from food aid shipments.</p>


<!-- <a href="#cost-per-ton"><h3> How much food does your money buy? </h3><a>
<a href="#recipients-per-ton"><h3> How many people get the food? </h3><a>
<a href="#cost-per-recipient"><h3> How much it costs to reach one person? </h3><a>
 -->

<!--  One U.S. dollar today purchases less food and feeds far fewer people in comparison to 2003 levels.
 -->
  <h2 id="cost-per-ton" class='mt20'>Cost per ton to ship food</h2>
  <div class='row posrel'>
    <p class="posabs text"></p>
    <div id='CTafrica' class='chart africa'><!--<label><input type="checkbox"> Sort values</label>--></div>

    <div id='CTasia' class='chart asia'><label></div>
    <div id='CTamericas' class='chart americas'></div>
  </div>
<p>The amount of money that USAID spends to ship a ton of food has steadily risen. Two factors have contributed to a rise in costs: a law that requires shippers to use expensive U.S.-flagged vessels and a spike in global food costs in 2008.</p>
  

  <h2 id="recipients-per-ton" class='mt20'>How many people a ton of food reaches</h2>
  <div class='row posrel'>
    <p class="posabs text"></p>
    <div id='RTafrica' class='chart africa'></div>
    <div id='RTasia' class='chart asia'></div>
    <div id='RTamericas' class='chart americas'></div>
  </div>  
  <p>Africa gets the highest volume of U.S. food aid, but a ton of food reaches fewer people in Africa than in other parts of the world because of high transportation costs and a complex transit network.</p>

  <h2 id="cost-per-recipient" class='mt20'>Cost per aid recipient</h2>
  <div class='row posrel'>
    <p class="posabs text"></p>
    <div id='CRafrica' class='chart africa'></div>
    <div id='CRasia' class='chart asia'></div>
    <div id='CRamericas' class='chart americas'></div>
  </div>
  <p>Due in part to rising food prices, the costs of delivering food to a person have doubled in the last decade. The program reaches fewer people for more money.</p>


<script>

//TO DO
//1. get universal styles from kate or kennedy- so it looks like the others. and colors for regions
//2. add the other sets of charts
//3. add headlines and chatter and annotation
//4. tooltips from kate

//maximums for each chart set
var costTonMax = 2100;
var recipientTonMax = 180;
var costRecipientMax = 170;

// recycleable vars

var label1 = "cost per ton";
var label2 = "recipients per ton";
var label3 = "cost per recipient";

var title1 = "Africa";
var title2 = "Asia";
var title3 = "Americas";

var color1 = "#C96916";
var color2 = "#1A374D";
var color3 = "#A4B48C";

var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 320 - margin.left - margin.right,
    height = 200 - margin.top - margin.bottom;



//one of these for each country and each row
charts("africaCT", '#CTafrica', costTonMax, label1, title1);
charts("asiaCT", '#CTasia', costTonMax, label1, title2);
charts("americasCT", '#CTamericas', costTonMax, label1, title3);

//run chart function with specific max for each row

charts("africaRT", '#RTafrica', recipientTonMax, label2, title1);
charts("asiaRT", '#RTasia', recipientTonMax, label2, title2);
charts("americasRT", '#RTamericas', recipientTonMax, label2, title3);

charts("africaCR", '#CRafrica', costRecipientMax, label3, title1);
charts("asiaCR", '#CRasia', costRecipientMax, label3, title2);
charts("americasCR", '#CRamericas', costRecipientMax, label3, title3);


// 'region' is the part of the world, 'id' is used to call the chart within the page, 'max' is the maximum value for that row of charts and 'label' is the y axis label

function charts(region, id, max, label, title, color){

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var x2 = d3.scale.ordinal()
  .rangeBands([0, width], 0);

var y = d3.scale.linear()
    .range([height, 0]);
  
var xFormat = d3.time.format('%y');

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .ticks(xFormat)

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .ticks(5, "$");

// writing a tooltip
/*var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<strong>Cost per ton of food:</strong> <span style='color:red'>" + d[region] + "</span>";
  })
*/
  //specifying where to put it
  var svg = d3.select(id).append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


  d3.tsv("data/data.tsv", type, function(error, data) {
    x.domain(data.map(function(d) { return d.year; })); //same for all
    x2.domain(data.map(function(d) { return 200; }));
    y.domain([0, max]); // var for max for set

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
      .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text(label);

    svg.append("text")
        .attr("x", width - 65)             
        .attr("y", 12)
        .attr("class", "title")  
        .text(title);


    svg.selectAll(".bar")
        .data(data)
      .enter().append("rect")
        .attr("class", function(d){return "bar y" + d.year})
        .attr('data-value', function(d){return d[region]})
        .attr("x", function(d) { return x(d.year); })
        .attr("width", x.rangeBand())
        .attr("y", function(d) { return y(d[region]); })
        .attr("height", function(d) { return height - y(d[region]); })
        //.on('mouseover', tip.show)
        //.on('mouseout', tip.hide)
        //adding hover stuff here
        .on('mouseover', function(d){
          var classes = $(this).attr('class').replace(/ /g,'.'); //this finds the class of what you've hovered on
          d3.selectAll('.'+classes).style({'stroke': 'black', 'stroke-width': 2}) //matches all of the things w/ the hovered class and gives them a stroke
          
        })
        .on('mouseout', function(d){
          var classes = $(this).attr('class').replace(/ /g,'.'); //re-finds the class, since we're in a new function
          d3.selectAll('.'+classes).style({'stroke': 'none', 'stroke-width': 0}) //removes the stroke. 
        


          var dataSum = d3.sum(data, function(d) { return d[region]; });
          var dataAvg = dataSum / data.length;
 

          var line = d3.svg.line()
          .x(function(d, i) { 
            // return x(i) + i;
            return x2(i) +i; 
          })
          .y(function(d, i) { return y(50); }); 
        
          svg.append("path")
              .datum(data)
              .attr("class", "line")
              .attr("d", line);


/*
// Having a go at sorting from biggest to smallest vaue
      d3.select("input").on("change", change);

      var sortTimeout = setTimeout(function() {
        d3.select("input").property("checked", true).each(change);
        }, 1000);

    function change() {
    clearTimeout(sortTimeout);

    // Copy-on-write since tweens are evaluated after a delay.
    var x0 = x.domain(data.sort(this.checked
        ? function(a, b) { return b[region] - a[region]; }
        : function(a, b) { return d3.ascending(a.year, b.year); })
        .map(function(d) { return d.year; }))
        .copy();

    var transition = svg.transition().duration(500),
        delay = function(d, i) { return i * 25; };

    transition.selectAll(".bar")
        .delay(delay)
        .attr("x", function(d) { return x0(d.year); });

    transition.select(".x.axis")
        .call(xAxis)
      .selectAll("g")
        .delay(delay);
  
  }
    
*/

       });

      });




}

function type(d) {
  d.region = +d.region; //coerces values to number
  return d;
}

</script>
